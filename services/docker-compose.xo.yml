services:
  xen-orchestra:
    image: ronivay/xen-orchestra:latest
    container_name: xen-orchestra
    restart: unless-stopped
    stop_grace_period: 1m
    labels:
      - all=true

    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      - HTTPS_PORT=443
      - REDIRECT_TO_HTTPS=true

    ports:
      #- 8080:80
      - 4443:443

    volumes:
      - ${DockerDir}/xen-orchestra/xo-data:/var/lib/xo-server
      - ${DockerDir}/xen-orchestra/redis-data:/var/lib/redis
      - ${DockerDir}/xen-orchestra/vddk-lib:/usr/local/lib/vddk
      # - ${DockerDir}/xen-orchestra/config:/etc/xo-server
      - ${DockerDir}/xen-orchestra/cert.pem:/cert.pem
      - ${DockerDir}/xen-orchestra/cert.key:/cert.key

    cap_add:
      - SYS_ADMIN

    security_opt:
      - apparmor:unconfined

    # Optional: only needed for fileâ€‘level restore
    # devices:
    #   - /dev/fuse:/dev/fuse
    #   - /dev/loop-control:/dev/loop-control
    #   - /dev/loop0:/dev/loop0

    networks:
      backend:
        aliases:
          - xen-orchestra

    logging:
      driver: json-file
      options:
        max-size: "1M"
        max-file: "2"


