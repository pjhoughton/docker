# Docker Compose master file with profiles

networks:
  backend:
    driver: bridge

volumes:
  docker_sock:
    driver: local

services:
  # --- Infra stack ---
  autoheal-server:
    extends:
      file: ./docker-compose.autoheal.yml
      service: autoheal
    profiles: ["infra"]
    volumes:
      - docker_sock:/var/run/docker.sock
      - /srv/autoheal-server:/autoheal   # unique persistent folder for infra VM
    labels:
      com.docker.compose.project: "infra"
      com.docker.compose.service: "autoheal-server"

  nginx-proxy-manager:
    extends:
      file: ./docker-compose.nginx.yml
      service: nginx-proxy-manager
    profiles: ["infra"]
    labels:
      com.docker.compose.project: "infra"
      com.docker.compose.service: "nginx-proxy-manager"
      autoheal: "true"

  homepage:
    extends:
      file: ./docker-compose.homepage.yml
      service: homepage
    profiles: ["infra"]
    labels:
      com.docker.compose.project: "infra"
      com.docker.compose.service: "homepage"
      autoheal: "true"

  # --- Media stack ---
  autoheal-iot:
    extends:
      file: ./docker-compose.autoheal.yml
      service: autoheal
    profiles: ["media"]
    volumes:
      - docker_sock:/var/run/docker.sock
      - /srv/autoheal-iot:/autoheal      # unique persistent folder for media VM
    labels:
      com.docker.compose.project: "media"
      com.docker.compose.service: "autoheal-iot"

  sabnzbd:
    extends:
      file: ./docker-compose.sabnzbd.yml
      service: sabnzbd
    profiles: ["media"]
    labels:
      com.docker.compose.project: "media"
      com.docker.compose.service: "sabnzbd"
      autoheal: "true"

  radarr:
    extends:
      file: ./docker-compose.radarr.yml
      service: radarr
    profiles: ["media"]
    labels:
      com.docker.compose.project: "media"
      com.docker.compose.service: "radarr"
      autoheal: "true"

  sonarr:
    extends:
      file: ./docker-compose.sonarr.yml
      service: sonarr
    profiles: ["media"]
    labels:
      com.docker.compose.project: "media"
      com.docker.compose.service: "sonarr"
      autoheal: "true"

  bazarr:
    extends:
      file: ./docker-compose.bazarr.yml
      service: bazarr
    profiles: ["media"]
    labels:
      com.docker.compose.project: "media"
      com.docker.compose.service: "bazarr"
      autoheal: "true"
